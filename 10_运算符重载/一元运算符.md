# 一元运算符重载

在 Rust 中，一元运算符是只作用于一个操作数的运算符。主要有两个可以重载的一元运算符：

1.  **负号 (`-`)**: 对应 `std::ops::Neg` trait。
2.  **非 (`!`)**: 对应 `std::ops::Not` trait，用于逻辑非或按位非。

这些 Trait 都定义在 `std::ops` 模块中。

## 1. `Neg` Trait (负号)

`Neg` trait 用于重载一元减号运算符 `-`。

### Trait 定义

```rust
pub trait Neg {
    type Output;
    fn neg(self) -> Self::Output;
}
```

注意 `neg` 方法获取 `self` 的所有权。这意味着使用 `-x` 后，`x` 可能会被移动（除非它实现了 `Copy` 或你是为引用实现的）。

### 示例：复数取负

假设我们有一个复数结构体 `Complex`，我们希望 `-c` 能得到一个新的、实部和虚部都取反的复数。

```rust
use std::ops::Neg;

#[derive(Debug, PartialEq)]
struct Complex {
    re: i32,
    im: i32,
}

impl Neg for Complex {
    type Output = Complex;

    fn neg(self) -> Complex {
        Complex {
            re: -self.re,
            im: -self.im,
        }
    }
}

fn main() {
    let c1 = Complex { re: 1, im: -2 };
    let c2 = -c1; // 调用 c1.neg()

    assert_eq!(c2, Complex { re: -1, im: 2 });
    
    // 注意：因为 Complex 没有实现 Copy，c1 在这里已经被移动了，无法再次使用
    // println!("{:?}", c1); // 编译错误：use of moved value
}
```

### 为引用实现 `Neg`

如果我们不想在运算时消耗掉原值，可以为引用类型 `&Complex` 实现 `Neg`。

```rust
impl Neg for &Complex {
    type Output = Complex;

    fn neg(self) -> Complex {
        Complex {
            re: -self.re,
            im: -self.im,
        }
    }
}

// 用法:
// let c1 = Complex { re: 1, im: -2 };
// let c2 = -&c1; // 此时 c1 依然可用
```

## 2. `Not` Trait (非)

`Not` trait 用于重载 `!` 运算符。它可以表示逻辑非（对布尔值）或按位非（对整数）。

### Trait 定义

```rust
pub trait Not {
    type Output;
    fn not(self) -> Self::Output;
}
```

### 示例：自定义布尔状态

假设我们有一个枚举表示某种开关状态，我们希望用 `!` 来切换状态。

```rust
use std::ops::Not;

#[derive(Debug, PartialEq)]
enum SwitchState {
    On,
    Off,
}

impl Not for SwitchState {
    type Output = SwitchState;

    fn not(self) -> SwitchState {
        match self {
            SwitchState::On => SwitchState::Off,
            SwitchState::Off => SwitchState::On,
        }
    }
}

fn main() {
    let state = SwitchState::On;
    let toggled = !state;
    
    assert_eq!(toggled, SwitchState::Off);
    assert_eq!(!toggled, SwitchState::On);
}
```

## 3. 总结

| 运算符 | Trait | 方法 | 说明 |
| :--- | :--- | :--- | :--- |
| `-` | `std::ops::Neg` | `neg` | 一元负号，通常用于数值类型取反。 |
| `!` | `std::ops::Not` | `not` | 一元非，用于逻辑取反或按位取反。 |

**关键点：**
*   一元运算符方法通常消耗 `self`。
*   如果你希望保留原值，请考虑为引用类型（如 `&T`）实现这些 Trait，或者让你的类型实现 `Copy` Trait。