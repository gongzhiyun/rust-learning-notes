# å…³è”å¸¸é‡

åœ¨ Rust ä¸­ï¼Œ**å…³è”å¸¸é‡ (Associated Constants)** æ˜¯æŒ‡å®šä¹‰åœ¨ `trait` æˆ– `impl` å—ä¸­çš„å¸¸é‡ã€‚

ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æŠŠä¸€ä¸ªå¸¸é‡â€œæŒ‚è½½â€åˆ°æŸä¸ªç±»å‹ï¼ˆstruct/enumï¼‰æˆ–ç‰¹å¾ï¼ˆtraitï¼‰åä¸‹ï¼Œè€Œä¸æ˜¯è®©å®ƒä½œä¸ºå…¨å±€å¸¸é‡é£˜åœ¨å¤–é¢ã€‚

## 1. åŸºç¡€è¯­æ³•

å…³è”å¸¸é‡çš„å†™æ³•å’Œæ™®é€šå¸¸é‡ `const` å‡ ä¹ä¸€æ ·ï¼Œåªæ˜¯å®ƒä½äºä»£ç å—å†…éƒ¨ã€‚

### A. åœ¨ Trait ä¸­å®šä¹‰

ä½ å¯ä»¥åœ¨ Trait ä¸­å£°æ˜ä¸€ä¸ªå¸¸é‡ï¼Œè¦æ±‚å®ç°è¯¥ Trait çš„ç±»å‹å¿…é¡»æä¾›å…·ä½“çš„å€¼ã€‚ä¹Ÿå¯ä»¥æä¾›é»˜è®¤å€¼ã€‚

```rust
trait MyConfig {
    // å£°æ˜å…³è”å¸¸é‡ï¼Œå¿…é¡»æŒ‡æ˜ç±»å‹
    const MAX_CONNECTIONS: u32;
    
    // å¸¦æœ‰é»˜è®¤å€¼çš„å…³è”å¸¸é‡
    const TIMEOUT: u32 = 30;
}
```

### B. åœ¨ impl ä¸­å®ç°

å½“ç»“æ„ä½“å®ç°è¿™ä¸ª Trait æ—¶ï¼Œå¿…é¡»ç»™æ²¡æœ‰é»˜è®¤å€¼çš„å¸¸é‡èµ‹å€¼ã€‚

```rust
struct Database;
struct FileSystem;

impl MyConfig for Database {
    // å¿…é¡»å®ç°
    const MAX_CONNECTIONS: u32 = 1000;
    // TIMEOUT ä½¿ç”¨é»˜è®¤å€¼ 30
}

impl MyConfig for FileSystem {
    const MAX_CONNECTIONS: u32 = 5;
    // è¦†ç›–é»˜è®¤å€¼
    const TIMEOUT: u32 = 60;
}
```

### C. å¦‚ä½•ä½¿ç”¨

ä½¿ç”¨æ—¶ä½¿ç”¨ `Type::CONST_NAME` çš„è¯­æ³•ï¼ˆåŒå†’å·ï¼‰ã€‚æ³¨æ„ï¼Œ**ä¸éœ€è¦å®ä¾‹**ï¼Œå®ƒæ˜¯å±äºç±»å‹çš„ï¼Œä¸æ˜¯å±äºå¯¹è±¡çš„ã€‚

```rust
fn main() {
    println!("DB Limit: {}", Database::MAX_CONNECTIONS); // è¾“å‡º 1000
    println!("FS Limit: {}", FileSystem::MAX_CONNECTIONS); // è¾“å‡º 5
    
    // é”™è¯¯ç¤ºèŒƒï¼š
    // let db = Database;
    // println!("{}", db.MAX_CONNECTIONS); // âŒ ä¸èƒ½é€šè¿‡å®ä¾‹è®¿é—®
}
```

## 2. ä¸ºä»€ä¹ˆè¦ç”¨å…³è”å¸¸é‡ï¼Ÿ

æ—¢ç„¶å¯ä»¥ç”¨ `fn get_limit() -> u32` æˆ–è€…å…¨å±€å¸¸é‡ `const DB_LIMIT: u32 = 1000`ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æä¸ªå…³è”å¸¸é‡ï¼Ÿ

**ä¼˜åŠ¿ 1ï¼šæ›´å¥½çš„å‘½åç©ºé—´ (Namespacing)**

å…¨å±€å¸¸é‡å®¹æ˜“é€ æˆå‘½åæ±¡æŸ“ã€‚

- **ä¸å¥½**ï¼š`const DB_MAX_CONN: u32 = 100;` å’Œ `const FS_MAX_CONN: u32 = 5;`
- **å¥½**ï¼š`Database::MAX_CONNECTIONS` å’Œ `FileSystem::MAX_CONNECTIONS`

è¿™è®©ä»£ç é€»è¾‘å½’å±æ›´æ¸…æ™°ã€‚æ ‡å‡†åº“ä¸­å¸¸è§çš„ä¾‹å­æ˜¯æ•´æ•°ç±»å‹çš„æœ€å¤§å€¼ï¼š`u32::MAX`, `i64::MIN`ã€‚

**ä¼˜åŠ¿ 2ï¼šæ€§èƒ½ä¸è¯­ä¹‰**

å…³è”å¸¸é‡æ˜¯åœ¨**ç¼–è¯‘æ—¶**å°±ç¡®å®šçš„ã€‚ å¦‚æœä½ å†™æˆæ–¹æ³• `fn max_connections(&self) -> u32 { 1000 }`ï¼š

1. è™½ç„¶ç¼–è¯‘å™¨é€šå¸¸ä¼šä¼˜åŒ–ï¼Œä½†è¯­ä¹‰ä¸Šå®ƒæ˜¯ä¸€ä¸ªè¿è¡Œæ—¶è°ƒç”¨ã€‚
2. ä½ éœ€è¦åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼ˆ`self`ï¼‰æ‰èƒ½è°ƒç”¨å®ƒã€‚
3. å†™èµ·æ¥éº»çƒ¦ï¼Œè°ƒç”¨æ—¶è¦åŠ æ‹¬å· `()`ã€‚

**ä¼˜åŠ¿ 3ï¼šç”¨äºæ³›å‹çº¦æŸï¼ˆæœ€å¼ºå¤§çš„ç”¨æ³•ï¼‰**

è¿™æ˜¯å…³è”å¸¸é‡æœ€æ ¸å¿ƒçš„ç”¨æ­¦ä¹‹åœ°ã€‚å½“ä½ ç¼–å†™æ³›å‹ä»£ç æ—¶ï¼Œä½ å¯ä»¥åˆ©ç”¨å…³è”å¸¸é‡æ¥åšä¸€äº›è¿è¡Œæ—¶æ–¹æ³•åšä¸åˆ°çš„äº‹æƒ…ï¼Œæ¯”å¦‚**å®šä¹‰æ•°ç»„é•¿åº¦**ã€‚

```rust
trait Buffer {
    // å®šä¹‰ç¼“å†²åŒºå¤§å°å¸¸é‡
    const SIZE: usize;
    
    fn create_buffer() -> [u8; Self::SIZE]; 
    // ğŸ‘† æ³¨æ„è¿™é‡Œï¼æ•°ç»„é•¿åº¦å¿…é¡»æ˜¯ç¼–è¯‘æ—¶å¸¸é‡ã€‚
    // å¦‚æœç”¨ fn get_size() -> usizeï¼Œè¿™é‡Œå°±ä¼šæŠ¥é”™ï¼Œå› ä¸ºå‡½æ•°è¿”å›å€¼æ˜¯è¿è¡Œæ—¶çš„ã€‚
}

struct UdpBuffer;
impl Buffer for UdpBuffer {
    const SIZE: usize = 1024;
    fn create_buffer() -> [u8; Self::SIZE] {
        [0; 1024]
    }
}
```

## 3. ä¸æ™®é€šå‡½æ•°çš„å¯¹æ¯”

| **ç‰¹æ€§**              | **å…³è”å¸¸é‡ (const X: T)** | **æ–¹æ³• (fn x() -> T)**     |
| --------------------- | ------------------------- | -------------------------- |
| **è°ƒç”¨æ—¶æœº**          | **ç¼–è¯‘æ—¶** (Compile-time) | è¿è¡Œæ—¶ (Runtime)           |
| **å†…å­˜ä½ç½®**          | ç±»ä¼¼ç¡¬ç¼–ç ï¼Œç›´æ¥åµŒå…¥ä»£ç   | æ ˆæˆ–å¯„å­˜å™¨                 |
| **éœ€è¦å®ä¾‹?**         | ä¸éœ€è¦ (`Type::CONST`)    | é€šå¸¸éœ€è¦ (`self.method()`) |
| **èƒ½å¦ç”¨äºæ•°ç»„é•¿åº¦?** | **èƒ½** (`[u8; T::SIZE]`)  | ä¸èƒ½                       |
| **è¯­æ³•ç³–**            | ç®€æ´ï¼Œæ— æ‹¬å·              | éœ€è¦æ‹¬å· `()`              |

## 4. å®é™…åº”ç”¨åœºæ™¯ä¸¾ä¾‹

å‡è®¾ä½ åœ¨å†™ä¸€ä¸ªå¤„ç†ä¸åŒå•ä½çš„ç‰©ç†åº“ã€‚

```rust
trait Unit {
    // æ¯ä¸ªå•ä½ç›¸å¯¹äºåŸºå‡†å•ä½çš„æ¢ç®—ç³»æ•°
    const CONVERSION_FACTOR: f64;
    
    fn to_base(value: f64) -> f64 {
        value * Self::CONVERSION_FACTOR
    }
}

struct Meter;
struct Kilometer;

impl Unit for Meter {
    const CONVERSION_FACTOR: f64 = 1.0;
}

impl Unit for Kilometer {
    const CONVERSION_FACTOR: f64 = 1000.0;
}

fn convert_generic<T: Unit>(value: f64) {
    // åœ¨æ³›å‹å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è®¿é—® T::CONVERSION_FACTOR
    println!("Value in base unit: {}", value * T::CONVERSION_FACTOR);
}

fn main() {
    convert_generic::<Kilometer>(2.5); // è¾“å‡º 2500.0
}
```

## æ€»ç»“

1. **å…³è”å¸¸é‡**æ˜¯å±äºç±»å‹æˆ– Trait çš„å¸¸é‡å€¼ã€‚
2. é€šè¿‡ `Type::NAME` è®¿é—®ã€‚
3. å®ƒä»¬æ¯”å…¨å±€å¸¸é‡æ›´æ•´æ´ï¼ˆæœ‰å‘½åç©ºé—´ï¼‰ã€‚
4. å®ƒä»¬æ¯”æ–¹æ³•æ›´å¿«ä¸”å¯ç”¨ä½œç¼–è¯‘æ—¶å‚æ•°ï¼ˆå¦‚æ•°ç»„å¤§å°ï¼‰ã€‚
